import{b as m,d as g,s as d}from"./index-CPFkeXTL.js";const f={status:"all",search:"",sortBy:"date",sortOrder:"desc"},p=m()(g((o,n)=>({deals:[],loading:!1,error:null,filters:f,fetchDeals:async()=>{o({loading:!0,error:null});const{data:s,error:t}=await d.from("deals").select("*").order("created_at",{ascending:!1});if(t){o({error:t.message,loading:!1});return}const{data:a}=await d.from("items").select("deal_id, status"),e=a||[],l=(s||[]).map(i=>{const u=e.filter(c=>c.deal_id===i.id);return{...i,itemCount:u.length,soldCount:u.filter(c=>c.status==="sold").length}});o({deals:l,loading:!1})},fetchDealById:async s=>{const{data:t,error:a}=await d.from("deals").select("*").eq("id",s).single();if(a)return o({error:a.message}),null;const{data:e}=await d.from("items").select("*").eq("deal_id",s).order("created_at",{ascending:!1}),r=t,l=e||[];return{...r,items:l,itemCount:l.length,soldCount:l.filter(i=>i.status==="sold").length}},createDeal:async s=>{const t=s,{data:a,error:e}=await d.from("deals").insert(t).select().single();return e?(o({error:e.message}),null):(n().fetchDeals(),a.id)},updateDeal:async(s,t)=>{const a=t,{error:e}=await d.from("deals").update(a).eq("id",s);if(e){o({error:e.message});return}o(r=>({deals:r.deals.map(l=>l.id===s?{...l,...t}:l)}))},deleteDeal:async s=>{const t={deal_id:null};await d.from("items").update(t).eq("deal_id",s);const{error:a}=await d.from("deals").delete().eq("id",s);if(a){o({error:a.message});return}o(e=>({deals:e.deals.filter(r=>r.id!==s)}))},setFilter:(s,t)=>{o(a=>({filters:{...a.filters,[s]:t}}))},resetFilters:()=>{o({filters:f})},filteredDeals:()=>{const{deals:s,filters:t}=n();let a=[...s];if(t.status!=="all"&&(a=a.filter(e=>e.status===t.status)),t.search){const e=t.search.toLowerCase();a=a.filter(r=>r.source?.toLowerCase().includes(e)||r.notes?.toLowerCase().includes(e))}return a.sort((e,r)=>{let l=0;switch(t.sortBy){case"profit":l=(e.estimated_profit||0)-(r.estimated_profit||0);break;case"value":l=(e.estimated_value||0)-(r.estimated_value||0);break;default:l=new Date(e.created_at).getTime()-new Date(r.created_at).getTime()}return t.sortOrder==="desc"?-l:l}),a},stats:()=>{const{deals:s}=n(),t=s.filter(e=>e.status==="active"),a=s.filter(e=>e.status==="completed");return{activeDeals:t.length,completedDeals:a.length,totalInvested:t.reduce((e,r)=>e+(r.total_cost||0),0),totalProfit:a.reduce((e,r)=>e+(r.actual_profit||0),0)}}}),{name:"DealsStore"}));export{p as u};
