import{c as p,r as u,j as e,f as o,P as w}from"./index-CPFkeXTL.js";import{u as k}from"./inventory-store-D7GLjq0X.js";import{u as M}from"./deals-store-DHUgIiis.js";import{D as P}from"./dollar-sign-c5L53ltU.js";import{T as v}from"./trending-up-Bb59yena.js";import{C as S}from"./calendar-CH4o-WYt.js";import{S as $}from"./shopping-bag-Ckpx03Rf.js";const R=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],I=p("arrow-down-right",R);const D=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],C=p("arrow-up-right",D);const T=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],A=p("percent",T);function H(){const{items:l,fetchItems:c}=k(),{fetchDeals:d}=M();u.useEffect(()=>{c(),d()},[c,d]);const a=u.useMemo(()=>l.filter(s=>s.status==="sold"),[l]),n=u.useMemo(()=>{const s=a.reduce((m,x)=>m+(x.sale_price||0),0),t=a.reduce((m,x)=>m+(x.actual_profit||0),0),r=a.reduce((m,x)=>m+(x.purchase_cost||0),0),i=a.reduce((m,x)=>m+(x.sale_fees||0),0),_=r>0?t/r*100:0;return{totalRevenue:s,totalProfit:t,totalCost:r,totalFees:i,itemsSold:a.length,avgRoi:_}},[a]),h=u.useMemo(()=>{const s={};return a.forEach(t=>{if(!t.sale_date)return;const r=new Date(t.sale_date),i=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;s[i]||(s[i]={revenue:0,profit:0,count:0}),s[i].revenue+=t.sale_price||0,s[i].profit+=t.actual_profit||0,s[i].count+=1}),Object.entries(s).sort(([t],[r])=>t.localeCompare(r)).slice(-6).map(([t,r])=>({month:F(t),...r}))},[a]),g=u.useMemo(()=>{const s={};return a.forEach(t=>{const r=t.sale_platform||"Unknown";s[r]||(s[r]={revenue:0,profit:0,count:0,fees:0}),s[r].revenue+=t.sale_price||0,s[r].profit+=t.actual_profit||0,s[r].count+=1,s[r].fees+=t.sale_fees||0}),Object.entries(s).map(([t,r])=>({name:t,...r})).sort((t,r)=>r.profit-t.profit)},[a]),j=u.useMemo(()=>[...a].sort((s,t)=>(t.actual_profit||0)-(s.actual_profit||0)).slice(0,5),[a]),N=u.useMemo(()=>[...a].sort((s,t)=>(s.actual_profit||0)-(t.actual_profit||0)).slice(0,5).filter(s=>(s.actual_profit||0)<0),[a]),y=Math.max(...h.map(s=>Math.abs(s.profit)),1);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Analytics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4",children:[e.jsx(f,{icon:P,label:"Total Revenue",value:o(n.totalRevenue),color:"text-blue-600"}),e.jsx(f,{icon:v,label:"Total Profit",value:o(n.totalProfit),color:n.totalProfit>=0?"text-green-600":"text-red-600"}),e.jsx(f,{icon:w,label:"Items Sold",value:n.itemsSold.toString(),color:"text-purple-600"}),e.jsx(f,{icon:A,label:"Avg ROI",value:`${n.avgRoi.toFixed(0)}%`,color:n.avgRoi>=0?"text-green-600":"text-red-600"})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"font-semibold",children:"Cost Breakdown"}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:o(n.totalCost)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Cost"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:o(n.totalFees)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Fees"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-2xl font-bold ${n.totalProfit>=0?"text-green-600":"text-red-600"}`,children:o(n.totalProfit)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Net Profit"})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),e.jsx("h2",{className:"font-semibold",children:"Profit by Month"})]}),h.length>0?e.jsx("div",{className:"mt-4 space-y-3",children:h.map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-12 text-sm text-muted-foreground",children:s.month}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"flex h-6 items-center",children:e.jsx("div",{className:`h-full rounded ${s.profit>=0?"bg-green-500":"bg-red-500"}`,style:{width:`${Math.abs(s.profit)/y*100}%`,minWidth:"4px"}})})}),e.jsx("span",{className:`w-20 text-right text-sm font-medium ${s.profit>=0?"text-green-600":"text-red-600"}`,children:o(s.profit)}),e.jsxs("span",{className:"w-12 text-right text-xs text-muted-foreground",children:[s.count," sold"]})]},s.month))}):e.jsx("div",{className:"mt-4 flex h-32 items-center justify-center text-muted-foreground",children:"No sales data yet"})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),e.jsx("h2",{className:"font-semibold",children:"Sales by Platform"})]}),g.length>0?e.jsx("div",{className:"mt-4 space-y-3",children:g.map(s=>e.jsxs("div",{className:"rounded-lg bg-muted/50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.count," sales"]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Revenue"}),e.jsx("p",{className:"font-medium",children:o(s.revenue)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Fees"}),e.jsx("p",{className:"font-medium text-amber-600",children:o(s.fees)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Profit"}),e.jsx("p",{className:`font-medium ${s.profit>=0?"text-green-600":"text-red-600"}`,children:o(s.profit)})]})]})]},s.name))}):e.jsx("div",{className:"mt-4 flex h-32 items-center justify-center text-muted-foreground",children:"No platform data yet"})]}),j.length>0&&e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-green-600"}),e.jsx("h2",{className:"font-semibold",children:"Top Performers"})]}),e.jsx("div",{className:"mt-3 space-y-2",children:j.map((s,t)=>e.jsx(b,{item:s,rank:t+1},s.id))})]}),N.length>0&&e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-red-600"}),e.jsx("h2",{className:"font-semibold",children:"Losses"})]}),e.jsx("div",{className:"mt-3 space-y-2",children:N.map((s,t)=>e.jsx(b,{item:s,rank:t+1,isLoss:!0},s.id))})]}),a.length===0&&e.jsxs("div",{className:"rounded-lg border p-8 text-center",children:[e.jsx(v,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"No sales data yet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Analytics will appear once you record some sales"})]})]})}function f({icon:l,label:c,value:d,color:a}){return e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:`h-4 w-4 ${a}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:c})]}),e.jsx("p",{className:"mt-1 text-xl font-bold",children:d})]})}function b({item:l,rank:c,isLoss:d}){return e.jsxs("div",{className:"flex items-center gap-3 rounded-lg bg-muted/50 p-2",children:[e.jsx("span",{className:`flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold ${d?"bg-red-100 text-red-600 dark:bg-red-900":"bg-green-100 text-green-600 dark:bg-green-900"}`,children:c}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("p",{className:"truncate font-medium",children:l.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l.platform," · Sold on ",l.sale_platform]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`font-medium ${(l.actual_profit||0)>=0?"text-green-600":"text-red-600"}`,children:o(l.actual_profit)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[o(l.purchase_cost)," → ",o(l.sale_price)]})]})]})}function F(l){const[c,d]=l.split("-");return new Date(parseInt(c),parseInt(d)-1).toLocaleDateString("en-US",{month:"short"})}export{H as AnalyticsPage};
