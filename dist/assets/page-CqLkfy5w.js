import{h as R,u as T,r as d,j as e,P as B,f as c}from"./index-CPFkeXTL.js";import{u as O}from"./deals-store-DHUgIiis.js";import{C as U}from"./confirm-modal-CNsLWem5.js";import{L as V}from"./loader-circle-Cke15f2O.js";import{A as k}from"./arrow-left-CJayjRUm.js";import{E as z}from"./ellipsis-vertical-D-UbPjlT.js";import{C as q}from"./circle-check-big-CZ38CVVF.js";import{T as G}from"./triangle-alert-Bfna1AUJ.js";import{C as H}from"./calendar-CH4o-WYt.js";import{T as J}from"./trending-up-Bb59yena.js";function le(){const{id:n}=R(),m=T(),{fetchDealById:u,updateDeal:D,deleteDeal:_}=O(),[t,g]=d.useState(null),[S,p]=d.useState(!0),[j,I]=d.useState(null),[N,x]=d.useState(!1),[P,v]=d.useState(!1);d.useEffect(()=>{async function s(){if(!n)return;p(!0);const r=await u(n);r?g(r):I("Deal not found"),p(!1)}s()},[n,u]);const E=()=>{x(!1),v(!0)},L=async()=>{n&&(await _(n),m("/deals"))},$=async()=>{if(!n||!t)return;const s=t.items?.filter(o=>o.status==="sold")||[],r=s.reduce((o,h)=>o+(h.sale_price||0),0),y=s.reduce((o,h)=>o+(h.actual_profit||0),0),F=t.total_cost?y/t.total_cost*100:0;await D(n,{status:"completed",actual_revenue:r,actual_profit:y,actual_roi:F});const C=await u(n);C&&g(C),x(!1)};if(S)return e.jsx("div",{className:"flex min-h-[50vh] items-center justify-center",children:e.jsx(V,{className:"h-8 w-8 animate-spin text-muted-foreground"})});if(j||!t)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>m("/deals"),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground",children:[e.jsx(k,{className:"h-4 w-4"}),"Back to Deals"]}),e.jsx("div",{className:"rounded-lg border border-destructive/50 bg-destructive/10 p-4 text-center",children:e.jsx("p",{className:"text-destructive",children:j||"Deal not found"})})]});const a=t.items||[],M=a.filter(s=>s.status==="in_stock"),A=a.filter(s=>s.status==="listed"),i=a.filter(s=>s.status==="sold"),b=a.length?i.length/a.length*100:0,w=(t.estimated_value||0)-(t.total_cost||0),f=i.reduce((s,r)=>s+(r.actual_profit||0),0),l=t.status==="completed";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>m("/deals"),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground",children:[e.jsx(k,{className:"h-4 w-4"}),"Back"]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>x(!N),"aria-label":"Deal options",className:"rounded-lg p-2 hover:bg-accent",children:e.jsx(z,{className:"h-5 w-5"})}),N&&e.jsxs("div",{className:"absolute right-0 top-full z-10 mt-1 w-48 rounded-lg border bg-background p-1 shadow-lg",children:[!l&&e.jsxs("button",{onClick:$,className:"flex w-full items-center gap-2 rounded px-3 py-2 text-sm hover:bg-accent",children:[e.jsx(q,{className:"h-4 w-4"}),"Mark Complete"]}),e.jsxs("button",{onClick:E,className:"flex w-full items-center gap-2 rounded px-3 py-2 text-sm text-destructive hover:bg-destructive/10",children:[e.jsx(G,{className:"h-4 w-4"}),"Delete Deal"]})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-xl font-bold",children:t.source||"Unknown Source"}),l&&e.jsx("span",{className:"rounded bg-green-100 px-2 py-0.5 text-xs font-medium text-green-700 dark:bg-green-900 dark:text-green-300",children:"Completed"})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-3.5 w-3.5"}),new Date(t.created_at).toLocaleDateString()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-3.5 w-3.5"}),a.length," items"]})]})]})}),t.notes&&e.jsx("p",{className:"mt-3 text-sm text-muted-foreground",children:t.notes})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"font-semibold",children:"Progress"}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[i.length," of ",a.length," items sold"]}),e.jsxs("span",{className:"font-medium",children:[Math.round(b),"%"]})]}),e.jsx("div",{className:"mt-2 h-3 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:`h-full rounded-full transition-all ${l?"bg-green-500":"bg-primary"}`,style:{width:`${b}%`}})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-2 text-center text-sm",children:[e.jsxs("div",{className:"rounded-lg bg-muted/50 p-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"In Stock"}),e.jsx("p",{className:"text-lg font-semibold",children:M.length})]}),e.jsxs("div",{className:"rounded-lg bg-muted/50 p-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Listed"}),e.jsx("p",{className:"text-lg font-semibold",children:A.length})]}),e.jsxs("div",{className:"rounded-lg bg-green-50 p-2 dark:bg-green-950",children:[e.jsx("p",{className:"text-muted-foreground",children:"Sold"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:i.length})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("h2",{className:"font-semibold",children:"Financials"}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Cost"}),e.jsx("span",{className:"font-medium",children:c(t.total_cost)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Estimated Value"}),e.jsx("span",{className:"font-medium",children:c(t.estimated_value)})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Estimated Profit"}),e.jsx("span",{className:`font-medium ${w>=0?"text-green-600":"text-red-600"}`,children:c(w)})]}),(i.length>0||l)&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:l?"Actual Profit":"Profit So Far"}),e.jsx("span",{className:`font-medium ${(l?t.actual_profit||0:f)>=0?"text-green-600":"text-red-600"}`,children:c(l?t.actual_profit:f)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:l?"Actual ROI":"Current ROI"}),e.jsxs("span",{className:"flex items-center gap-1 font-medium",children:[e.jsx(J,{className:"h-4 w-4"}),l&&t.actual_roi!==null?`${t.actual_roi.toFixed(0)}%`:t.total_cost?`${(f/t.total_cost*100).toFixed(0)}%`:"0%"]})]})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsxs("h2",{className:"font-semibold",children:["Items (",a.length,")"]}),e.jsx("div",{className:"mt-3 space-y-2",children:a.length===0?e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No items in this deal"}):a.map(s=>e.jsxs("button",{onClick:()=>m(`/inventory/${s.id}`),className:"flex w-full items-center justify-between rounded-lg bg-muted/50 p-3 text-left hover:bg-muted",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.platform," Â· ",s.condition||"Unknown"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium",children:c(s.estimated_value)}),e.jsx("p",{className:"text-sm",children:s.status==="sold"?e.jsxs("span",{className:"text-green-600",children:["Sold: ",c(s.actual_profit)," profit"]}):e.jsx("span",{className:`${s.status==="listed"?"text-amber-600":"text-muted-foreground"}`,children:s.status==="listed"?"Listed":"In Stock"})})]})]},s.id))})]}),e.jsx(U,{isOpen:P,title:"Delete Deal",message:"Are you sure you want to delete this deal? Items will be unlinked but not deleted.",confirmLabel:"Delete",onConfirm:L,onCancel:()=>v(!1)})]})}export{le as DealDetailPage};
